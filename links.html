<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YoSinTV - Match Channels</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #007bff;
      --background-color: #f5f7fa;
      --card-bg: #ffffff;
      --text-color: #333333;
      --accent-color: #00aaff;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 6px 16px rgba(0, 0, 0, 0.15);
      --border-radius: 16px;
      --font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e2e8f0 100%);
      color: var(--text-color);
      font-family: var(--font-family);
      line-height: 1.6;
    }

    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    .container {
      padding-top: 3rem;
      padding-bottom: 4rem;
      max-width: 600px;
    }

    .card {
      background-color: var(--card-bg);
      border: none;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
      padding: 2rem;
    }

    h2 {
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--primary-color);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }

    .btn-channel {
      display: block;
      width: 100%;
      text-align: center;
      border-radius: 50px;
      padding: 12px 20px;
      font-weight: 500;
      background-color: var(--primary-color);
      color: white;
      transition: background-color 0.2s, transform 0.2s;
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }

    .btn-channel:hover {
      background-color: #0056b3;
      transform: scale(1.02);
    }

    .match-details {
      font-size: 0.95rem;
      color: var(--secondary-color);
      margin-bottom: 1.5rem;
    }

    .btn-back {
      border-radius: 50px;
      padding: 10px 24px;
      font-weight: 600;
      background-color: var(--accent-color);
      border: none;
      transition: background-color 0.2s, transform 0.2s;
      margin-top: 1.5rem;
    }

    .btn-back:hover {
      background-color: #0088cc;
      transform: scale(1.05);
    }

    .loading-spinner {
      display: none;
      text-align: center;
      padding: 2rem;
    }

    .loading-spinner.active {
      display: block;
    }

    .error-message {
      text-align: center;
      padding: 2rem;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      color: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2 id="match-title"></h2>
      <div id="match-details" class="match-details"></div>
      <div id="channels-container"></div>
      <div id="loading-spinner" class="loading-spinner active">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <div id="error-message" class="error-message d-none">
        <p>Failed to load channels.</p>
        <button class="btn btn-back" onclick="fetchChannels()">Retry</button>
      </div>
      <a href="index.html" class="btn btn-back">Back to Events</a>
    </div>
  </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const matchTitle = document.getElementById('match-title');
  const matchDetails = document.getElementById('match-details');
  const channelsContainer = document.getElementById('channels-container');
  const loadingSpinner = document.getElementById('loading-spinner');
  const errorMessage = document.getElementById('error-message');

  function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      match: decodeURIComponent(params.get('match') || ''),
      sport: decodeURIComponent(params.get('sport') || ''),
      tournament: decodeURIComponent(params.get('tournament') || ''),
      timestamp: Number(params.get('timestamp') || 0)
    };
  }

  function formatDate(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo' });
  }

  async function fetchChannels() {
    const { match, sport, tournament, timestamp } = getQueryParams();
    matchTitle.textContent = match;
    matchDetails.innerHTML = `<strong>${sport}</strong> - ${tournament}<br>${formatDate(timestamp)}`;
    try {
      loadingSpinner.classList.add('active');
      errorMessage.classList.add('d-none');
      const res = await fetch('https://topembed.pw/api.php?format=json');
      const data = await res.json();
      let allEvents = [];
      for (let date in data.events) {
        allEvents.push(...data.events[date]);
      }
      const event = allEvents.find(e => e.match === match && e.sport === sport && e.tournament === tournament && e.unix_timestamp === timestamp);
      channelsContainer.innerHTML = '';
      if (event && event.channels && event.channels.length > 0) {
        event.channels.forEach((link, index) => {
          const a = document.createElement('a');
          a.href = `https://ww.yosintvlive.com/ft?src=${encodeURIComponent(link)}`;
          a.target = '_blank';
          a.className = 'btn btn-channel';
          a.textContent = `Link ${index + 1}`;
          a.setAttribute('aria-label', `Watch ${match} on channel ${index + 1}`);
          channelsContainer.appendChild(a);
        });
      } else {
        channelsContainer.innerHTML = '<p class="text-center">No channels available for this match.</p>';
      }
      loadingSpinner.classList.remove('active');
    } catch (err) {
      loadingSpinner.classList.remove('active');
      errorMessage.classList.remove('d-none');
    }
  }

  fetchChannels();
</script>
</body>
</html>
