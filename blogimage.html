<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Image Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #canvasContainer {
      position: relative;
      width: 600px;
      height: 400px;
      border: 1px solid black;
    }
    canvas {
      position: relative;
      z-index: 1;
    }
    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.5;
    }
    .error {
      color: red;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body class="p-4">
  <div class="input-group">
    <label for="img1Url" class="block text-sm font-medium text-gray-700">Team 1 Logo URL:</label>
    <input type="text" id="img1Url" value="" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" placeholder="Enter Team 1 Logo URL">
    <div id="error1" class="error hidden"></div>
  </div>
  <div class="input-group mt-2">
    <label for="img2Url" class="block text-sm font-medium text-gray-700">Team 2 Logo URL:</label>
    <input type="text" id="img2Url" value="" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" placeholder="Enter Team 2 Logo URL">
    <div id="error2" class="error hidden"></div>
  </div>
  <div class="input-group mt-2">
    <label for="customName" class="block text-sm font-medium text-gray-700">Custom Image Name:</label>
    <input type="text" id="customName" value="team_vs" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" placeholder="Enter custom name (e.g., match_image)">
  </div>
  <div id="canvasContainer">
    <canvas id="myCanvas" width="600" height="400"></canvas>
    <div id="background" class="background"></div>
  </div>
  <button onclick="downloadImage()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600" disabled>Download Image</button>
  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');
    const img1UrlInput = document.getElementById('img1Url');
    const img2UrlInput = document.getElementById('img2Url');
    const error1 = document.getElementById('error1');
    const error2 = document.getElementById('error2');
    const downloadBtn = document.querySelector('button');
    const customNameInput = document.getElementById('customName');
    const background = document.getElementById('background');

    let img1 = new Image();
    let img2 = new Image();
    let color1 = { r: 0, g: 0, b: 0 }; // First selected color
    let color2 = { r: 0, g: 0, b: 0 }; // Second selected color
    let isFirstColorSelected = false;

    // Set initial background
    window.onload = function() {
      canvas.addEventListener('click', handleClick);
      canvas.addEventListener('mousemove', drawCursor);
      canvas.addEventListener('mouseleave', clearCursor);
    };

    function loadImages() {
      const url1 = img1UrlInput.value.trim();
      const url2 = img2UrlInput.value.trim();

      if (!url1 && !url2) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (url1) {
        img1 = new Image();
        img1.crossOrigin = "Anonymous";
        img1.onload = function() {
          ctx.drawImage(img1, 20, 80, 200, 200); // Left side
          if (img2.complete) drawVsAndImg2();
          checkImagesLoaded();
        };
        img1.onerror = function() {
          showError(error1, 'Failed to load Team 1 image. Check the URL.');
          checkImagesLoaded();
        };
        img1.src = url1;
      }

      if (url2) {
        img2 = new Image();
        img2.crossOrigin = "Anonymous";
        img2.onload = function() {
          ctx.drawImage(img2, 380, 80, 200, 200); // Right side
          if (img1.complete) drawVs();
          checkImagesLoaded();
        };
        img2.onerror = function() {
          showError(error2, 'Failed to load Team 2 image. Check the URL.');
          checkImagesLoaded();
        };
        img2.src = url2;
      }

      if (!url1) hideError(error1);
      if (!url2) hideError(error2);
    }

    function showError(element, message) {
      element.textContent = message;
      element.classList.remove('hidden');
    }

    function hideError(element) {
      element.classList.add('hidden');
    }

    function drawVs() {
      ctx.beginPath();
      ctx.arc(canvas.width / 2, canvas.height / 2, 30, 0, Math.PI * 2);
      ctx.fillStyle = 'black';
      ctx.fill();
      ctx.font = '25px Arial';
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';
      ctx.fillText('vs', canvas.width / 2, canvas.height / 2 + 8);
      
      // Add watermark
      ctx.font = '16px Arial';
      ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
      ctx.textAlign = 'center';
      ctx.fillText('www.yosin-tv.net', canvas.width / 2, canvas.height - 30);
    }

    function drawVsAndImg2() {
      drawVs();
      ctx.drawImage(img2, 380, 80, 200, 200);
    }

    function checkImagesLoaded() {
      const hasContent = ctx.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0);
      downloadBtn.disabled = !hasContent;
    }

    function handleClick(event) {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const imageData = ctx.getImageData(x, y, 1, 1).data;
      const color = { r: imageData[0], g: imageData[1], b: imageData[2] };

      if (!isFirstColorSelected) {
        color1 = color;
        isFirstColorSelected = true;
      } else {
        color2 = color;
        isFirstColorSelected = false;
        setDynamicBackground();
      }
      redrawCanvas();
    }

    function setDynamicBackground() {
      background.style.background = `linear-gradient(45deg, rgba(${color1.r}, ${color1.g}, ${color1.b}, 0.7), rgba(${color2.r}, ${color2.g}, ${color2.b}, 0.7))`;
    }

    function drawCursor(event) {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      redrawCanvas(); // Clear previous cursor
      ctx.beginPath();
      ctx.arc(x, y, 5, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
      ctx.fill();
      ctx.closePath();
    }

    function redrawCanvas() {
      loadImages(); // Redraw images and vs
    }

    function clearCursor() {
      redrawCanvas(); // Redraw without cursor
    }

    function downloadImage() {
      setTimeout(() => {
        // Create a temporary canvas to composite the background
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');

        // Check if colors are manually selected (not default black)
        if (color1.r === 0 && color1.g === 0 && color1.b === 0 && color2.r === 0 && color2.g === 0 && color2.b === 0) {
          // Default to white background if no colors selected
          tempCtx.fillStyle = 'white';
          tempCtx.fillRect(0, 0, canvas.width, canvas.height);
        } else {
          // Use selected colors for gradient
          const gradient = tempCtx.createLinearGradient(0, 0, canvas.width, canvas.height);
          gradient.addColorStop(0, `rgb(${color1.r}, ${color1.g}, ${color1.b})`);
          gradient.addColorStop(1, `rgb(${color2.r}, ${color2.g}, ${color2.b})`);
          tempCtx.fillStyle = gradient;
          tempCtx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // Draw the current canvas content on top
        tempCtx.drawImage(canvas, 0, 0);

        const customName = customNameInput.value.trim() || 'team_vs';
        const link = document.createElement('a');
        link.download = `${customName}.png`;
        link.href = tempCanvas.toDataURL('image/png', 1.0);
        link.click();
      }, 100);
    }

    img1UrlInput.addEventListener('input', loadImages);
    img2UrlInput.addEventListener('input', loadImages);

    loadImages();
  </script>
</body>
</html>
