<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>blv Match List</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f9fafb; margin: 0; padding: 20px; color: #333; display: flex; justify-content: center; }
    main { max-width: 720px; width: 100%; background: #fff; padding: 25px 30px; border-radius: 10px; box-shadow: 0 8px 18px rgba(0,0,0,0.08); }
    h1 { margin-top: 0; font-weight: 700; font-size: 1.9rem; color: #222; user-select: none; }
    #updateTime { margin-top: 5px; margin-bottom: 20px; color: #555; font-size: 1rem; line-height: 1.4; user-select: none; }
    p { margin-top: 5px; margin-bottom: 20px; color: #555; font-size: 1rem; line-height: 1.4; user-select: none; }
    textarea { width: 100%; min-height: 160px; padding: 14px 16px; font-family: 'Courier New', Courier, monospace; font-size: 15px; border: 2px solid #ddd; border-radius: 8px; resize: vertical; transition: border-color 0.3s ease; outline-offset: 2px; }
    textarea:focus { border-color: #4a90e2; outline: none; box-shadow: 0 0 8px rgba(74, 144, 226, 0.4); }
    button.extract-btn { margin-top: 15px; padding: 12px 25px; font-size: 16px; font-weight: 600; background: #4a90e2; border: none; border-radius: 8px; color: white; cursor: pointer; box-shadow: 0 4px 12px rgba(74,144,226,0.5); transition: background-color 0.25s ease, box-shadow 0.25s ease; user-select: none; }
    button.extract-btn:hover { background: #357ABD; box-shadow: 0 6px 18px rgba(53,122,189,0.7); }
    #searchBar { width: 100%; padding: 12px 16px; font-size: 16px; margin: 28px 0 12px 0; border: 2px solid #ddd; border-radius: 8px; transition: border-color 0.3s ease; outline-offset: 2px; display: none; }
    #searchBar:focus { border-color: #4a90e2; outline: none; box-shadow: 0 0 8px rgba(74, 144, 226, 0.4); }
    #results { font-size: 1rem; color: #222; }
    h2 { margin-top: 36px; margin-bottom: 12px; font-weight: 700; font-size: 1.3rem; border-bottom: 2px solid #e1e5eb; padding-bottom: 6px; user-select: text; }
    .blv-container { margin-bottom: 20px; }
    .blv-container pre { background: #f5f5f5; padding: 10px; border-radius: 6px; font-family: 'Courier New', Courier, monospace; font-size: 14px; overflow-x: auto; max-height: 200px; white-space: pre-wrap; word-wrap: break-word; }
    .blv-container button { margin: 6px 8px 6px 0; padding: 8px 16px; font-size: 14px; border-radius: 6px; border: 1.5px solid #4a90e2; background-color: #f0f5ff; color: #1a3c7d; cursor: pointer; box-shadow: 0 1px 3px rgba(74,144,226,0.3); transition: background-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease; user-select: text; position: relative; display: inline-flex; align-items: center; padding-right: 30px; }
    .blv-container button:hover { background-color: #d3e0ff; box-shadow: 0 4px 10px rgba(74,144,226,0.5); color: #154a96; }
    .copy-tick { position: absolute; top: 4px; right: 4px; width: 18px; height: 18px; fill: #2e7d32; user-select: none; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }
    .copy-tick.show { opacity: 1; }
    .blv-ids { margin-top: 10px; }
    @media (max-width: 480px) {
      main { padding: 20px 15px; }
      .blv-container button { margin: 5px 5px 5px 0; padding: 7px 12px; font-size: 13px; padding-right: 28px; }
      .copy-tick { width: 16px; height: 16px; top: 3px; right: 3px; }
    }
  </style>
</head>
<body>
  <main>
    <div id="updateTime"></div>
    <textarea id="linksInput" placeholder="Paste your links here..."></textarea>
    <button class="extract-btn" onclick="extractBroadcasts()">Extract Broadcasts</button>
    <input type="text" id="searchBar" placeholder="Search matches or broadcast numbers..." oninput="filterResults()" />
    <div id="results"></div>
  </main>
  <script>
    const STORAGE_KEY = 'broadcastExtractorData';
    const STORAGE_TIME_KEY = 'broadcastExtractorTimestamp';
    const ONE_DAY_MS = 40 * 60 * 60 * 1000;
    let currentTickButton = null;

    function formatTimeAgo(timestamp) {
      const now = Date.now();
      const diffMs = now - timestamp;
      const seconds = Math.floor(diffMs / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      if (seconds < 60) return `Updated just now`;
      if (minutes < 60) return `Updated ${minutes} minute${minutes === 1 ? '' : 's'} ago`;
      if (hours < 24) return `Updated ${hours} hour${hours === 1 ? '' : 's'} ago`;
      if (days < 7) return `Updated ${days} day${days === 1 ? '' : 's'} ago`;
      return `Updated on ${new Date(timestamp).toLocaleString()}`;
    }

    function updateTimeDisplay() {
      const savedTime = localStorage.getItem(STORAGE_TIME_KEY);
      const updateTimeDiv = document.getElementById('updateTime');
      if (savedTime) {
        updateTimeDiv.textContent = formatTimeAgo(parseInt(savedTime));
      } else {
        updateTimeDiv.textContent = '';
      }
    }

    window.onload = function() {
      clearExpiredData();
      const savedData = localStorage.getItem(STORAGE_KEY);
      updateTimeDisplay();
      if (savedData) {
        const parsed = JSON.parse(savedData);
        if (parsed && typeof parsed === 'object') {
          displayResults(parsed);
          document.getElementById('searchBar').style.display = 'block';
        }
      }
      setInterval(updateTimeDisplay, 60 * 1000);
    };

    function clearExpiredData() {
      const savedTime = localStorage.getItem(STORAGE_TIME_KEY);
      if (savedTime && Date.now() - savedTime > ONE_DAY_MS) {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(STORAGE_TIME_KEY);
      }
    }

    function extractBroadcasts() {
      const input = document.getElementById('linksInput').value.trim();
      const resultsDiv = document.getElementById('results');
      const searchBar = document.getElementById('searchBar');
      resultsDiv.innerHTML = '';
      if (!input) {
        alert('Please paste some links first.');
        return;
      }
      const lines = input.split('\n').map(line => line.trim()).filter(line => line);
      const urlPattern = /\/truc-tiep\/([^\/\?]+).*blv=(\d+)/i;
      const matches = {};
      lines.forEach(link => {
        const match = link.match(urlPattern);
        if (match) {
          const matchName = match[1];
          const blv = match[2];
          if (!matches[matchName]) {
            matches[matchName] = new Set();
          }
          matches[matchName].add(blv);
        }
      });
      if (Object.keys(matches).length === 0) {
        alert('No valid links with broadcast numbers found.');
        return;
      }
      const matchesForStorage = {};
      for (const key in matches) {
        matchesForStorage[key] = Array.from(matches[key]);
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(matchesForStorage));
      localStorage.setItem(STORAGE_TIME_KEY, Date.now().toString());
      displayResults(matchesForStorage);
      searchBar.style.display = 'block';
      searchBar.value = '';
      updateTimeDisplay();
      removeCurrentTick();
    }

    function formatMatchName(matchName) {
      const parts = matchName.split('-');
      const datePattern = /\d{2,4}/;
      const filteredParts = parts.filter(part => !datePattern.test(part) && part.toLowerCase() !== 'vs');
      return filteredParts
        .map(part => part.charAt(0).toUpperCase() + part.slice(1))
        .join(' ')
        .replace(/\s+/g, ' ')
        .replace(/ vs /i, ' vs ');
    }

    function generateJsonData(blvs) {
      const data = [];
      if (blvs[0]) {
        data.push(` "https://yosintv2.github.io/ads/foot.html?url=https://ytvlive.pages.dev/ak?m=${blvs[0]}",`);
      }
      if (blvs.length > 1) {
        data.push(`   "https://yosintv2.github.io/ads.html", `);
        data.push(`   "https://yosintv2.github.io/ads/foot.html?url=https://ytvlive.pages.dev/ak?m=${blvs[1]}" `);
        data.push(''); // Adds a one-line space after the second link
      }
      return data.join('\n');
    }

    function displayResults(matches) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';
      for (const matchName in matches) {
        const heading = document.createElement('h2');
        heading.textContent = formatMatchName(matchName);
        resultsDiv.appendChild(heading);
        const container = document.createElement('div');
        container.className = 'blv-container';
        const pre = document.createElement('pre');
        pre.textContent = generateJsonData(matches[matchName].slice(0, 2));
        container.appendChild(pre);
        const copyBtn = document.createElement('button');
        copyBtn.textContent = 'Copy JSON';
        copyBtn.title = 'Click to copy JSON';
        copyBtn.onclick = () => copyToClipboard(pre.textContent, copyBtn);
        container.appendChild(copyBtn);
        const blvIdsDiv = document.createElement('div');
        blvIdsDiv.className = 'blv-ids';
        matches[matchName].forEach(blv => {
          const btn = document.createElement('button');
          btn.textContent = blv;
          btn.title = 'Click to copy BLV ID';
          btn.onclick = () => copyToClipboard(blv, btn);
          blvIdsDiv.appendChild(btn);
        });
        container.appendChild(blvIdsDiv);
        resultsDiv.appendChild(container);
      }
    }

    function copyToClipboard(text, btn) {
      navigator.clipboard.writeText(text).then(() => {
        showCopyTick(btn);
      }, () => {
        alert('Failed to copy to clipboard.');
      });
    }

    function showCopyTick(button) {
      removeCurrentTick();
      const svgns = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgns, "svg");
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.classList.add('copy-tick', 'show');
      const path = document.createElementNS(svgns, "path");
      path.setAttribute("d", "M20.285 6.708l-11.4 11.4-5.37-5.37 1.414-1.414 3.957 3.956 9.986-9.985z");
      svg.appendChild(path);
      button.appendChild(svg);
      currentTickButton = button;
    }

    function removeCurrentTick() {
      if (currentTickButton) {
        const oldTick = currentTickButton.querySelector('.copy-tick');
        if (oldTick) {
          oldTick.remove();
        }
        currentTickButton = null;
      }
    }

    function filterResults() {
      const query = document.getElementById('searchBar').value.toLowerCase();
      const resultsDiv = document.getElementById('results');
      if (!query) {
        [...resultsDiv.children].forEach(child => {
          child.style.display = '';
        });
        return;
      }
      for (let i = 0; i < resultsDiv.children.length; i += 2) {
        const heading = resultsDiv.children[i];
        const blvContainer = resultsDiv.children[i + 1];
        const matchName = heading.textContent.toLowerCase();
        const pre = blvContainer.querySelector('pre');
        const jsonText = pre.textContent.toLowerCase();
        const blvIdsDiv = blvContainer.querySelector('.blv-ids');
        let anyBlvMatch = false;
        [...blvIdsDiv.children].forEach(btn => {
          const blvText = btn.textContent.toLowerCase();
          if (blvText.includes(query)) {
            anyBlvMatch = true;
          }
        });
        if (jsonText.includes(query) || matchName.includes(query) || anyBlvMatch) {
          heading.style.display = '';
          blvContainer.style.display = '';
          [...blvIdsDiv.children].forEach(btn => {
            btn.style.display = '';
          });
        } else {
          heading.style.display = 'none';
          blvContainer.style.display = 'none';
        }
      }
    }
  </script> <!--Lol-->
</body>
</html>
