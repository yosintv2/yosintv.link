<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- https://gemini.google.com/app/5f37299c71f93262-->
  <title>BLV Stream Link Extractor</title>
  <style>
    :root {
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --bg-body: #f3f4f6;
      --bg-card: #ffffff;
      --text-main: #1f2937;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --success: #10b981;
    }

    * { box-sizing: border-box; transition: all 0.2s ease; }
    
    body {
      font-family: 'Inter', -apple-system, system-ui, sans-serif;
      background: var(--bg-body);
      margin: 0;
      padding: 40px 20px;
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    main {
      max-width: 850px;
      width: 100%;
    }

    .header-section {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.2rem;
      font-weight: 800;
      letter-spacing: -0.025em;
      margin-bottom: 8px;
      color: #111827;
    }

    #updateTime {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .card {
      background: var(--bg-card);
      padding: 30px;
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      padding: 16px;
      font-family: 'Fira Code', 'Courier New', monospace;
      font-size: 14px;
      border: 2px solid var(--border);
      border-radius: 12px;
      resize: vertical;
      background: #f9fafb;
    }

    textarea:focus {
      border-color: var(--primary);
      outline: none;
      background: #fff;
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      align-items: center;
    }

    button.extract-btn {
      padding: 12px 28px;
      font-size: 15px;
      font-weight: 600;
      background: var(--primary);
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button.extract-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    #searchBar {
      flex-grow: 1;
      padding: 12px 16px;
      font-size: 15px;
      border: 2px solid var(--border);
      border-radius: 10px;
      display: none;
    }

    #searchBar:focus {
      border-color: var(--primary);
      outline: none;
    }

    .match-card {
      background: white;
      margin-top: 25px;
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .match-header {
      background: #f8fafc;
      padding: 15px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .match-title {
      font-weight: 700;
      color: #1e293b;
      font-size: 1.1rem;
      text-transform: capitalize;
    }

    .badge {
      background: #e0e7ff;
      color: #4338ca;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
    }

    .match-body {
      padding: 20px;
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 18px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.6;
      overflow-x: auto;
      margin-bottom: 15px;
      position: relative;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-copy-main {
      background: #f1f5f9;
      border: 1px solid var(--border);
      color: var(--text-main);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-copy-main:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .blv-id-chip {
      background: #fff;
      border: 1px solid #cbd5e1;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .blv-id-chip:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .success-text {
      color: var(--success);
      font-size: 12px;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .actions { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>

<main>
  <div class="header-section">
    <h1>Broadcaster Extractor</h1>
    <div id="updateTime"></div>
  </div>

  <div class="card">
    <textarea id="linksInput" placeholder="Paste streaming links here (one per line)..."></textarea>
    <div class="actions">
      <button class="extract-btn" onclick="extractBroadcasts()">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
        Process Links
      </button>
      <input type="text" id="searchBar" placeholder="Quick search matches..." oninput="filterResults()" />
    </div>
  </div>

  <div id="results"></div>
</main>

<script>
  const STORAGE_KEY = 'broadcastExtractorData';
  const STORAGE_TIME_KEY = 'broadcastExtractorTimestamp';
  const ONE_DAY_MS = 24 * 60 * 60 * 1000;

  function formatTimeAgo(timestamp) {
    const diff = Math.floor((Date.now() - timestamp) / 1000);
    if (diff < 60) return 'Updated just now';
    if (diff < 3600) return `Updated ${Math.floor(diff/60)}m ago`;
    return `Updated ${new Date(timestamp).toLocaleTimeString()}`;
  }

  function updateTimeDisplay() {
    const savedTime = localStorage.getItem(STORAGE_TIME_KEY);
    const div = document.getElementById('updateTime');
    if (savedTime) div.textContent = formatTimeAgo(parseInt(savedTime));
  }

  window.onload = function() {
    const savedData = localStorage.getItem(STORAGE_KEY);
    updateTimeDisplay();
    if (savedData) {
      displayResults(JSON.parse(savedData));
      document.getElementById('searchBar').style.display = 'block';
    }
    setInterval(updateTimeDisplay, 30000);
  };

  function extractBroadcasts() {
    const input = document.getElementById('linksInput').value.trim();
    if (!input) return;

    const lines = input.split('\n').map(l => l.trim()).filter(l => l);
    const urlPattern = /\/truc-tiep\/([^\/\?]+).*blv=(\d+)/i;
    const matches = {};

    lines.forEach(link => {
      const parts = link.match(urlPattern);
      if (parts) {
        const name = parts[1].replace(/-/g, ' ');
        if (!matches[name]) matches[name] = new Set();
        matches[name].add(parts[2]);
      }
    });

    const finalData = {};
    for (const key in matches) finalData[key] = Array.from(matches[key]);

    localStorage.setItem(STORAGE_KEY, JSON.stringify(finalData));
    localStorage.setItem(STORAGE_TIME_KEY, Date.now().toString());
    
    displayResults(finalData);
    document.getElementById('searchBar').style.display = 'block';
    updateTimeDisplay();
  }

  function generateJsonData(blvs) {
    const ads = `    "https://yosintv-api.pages.dev/api/ads", `;
    const base = `    "https://yosintv2.github.io/ads/foot.html?url=https://ytvlive.pages.dev/ak?m=`;
    
    let links = [ads];
    links.push(`${base}${blvs[0]}", `);
    if (blvs[1]) links.push(`${base}${blvs[1]}", `);
    links.push(`${base}${blvs[2] || blvs[0]}"`);
    
    return links.join('\n');
  }

  function displayResults(matches) {
    const container = document.getElementById('results');
    container.innerHTML = '';

    Object.entries(matches).forEach(([name, ids]) => {
      const section = document.createElement('div');
      section.className = 'match-card';
      const jsonContent = generateJsonData(ids);

      section.innerHTML = `
        <div class="match-header">
          <span class="match-title">${name}</span>
          <span class="badge">${ids.length} Broadcasters</span>
        </div>
        <div class="match-body">
          <pre id="pre-${name}">${jsonContent}</pre>
          <div class="btn-group">
            <button class="btn-copy-main" onclick="copyText('pre-${name}', this)">Copy JSON Config</button>
            ${ids.map(id => `
              <button class="blv-id-chip" onclick="copyValue('${id}', this)">
                <small>ID:</small> <strong>${id}</strong>
              </button>
            `).join('')}
          </div>
        </div>
      `;
      container.appendChild(section);
    });
  }

  async function copyText(elementId, btn) {
    const text = document.getElementById(elementId).innerText;
    await navigator.clipboard.writeText(text);
    handleFeedback(btn, 'Copied!');
  }

  async function copyValue(val, btn) {
    await navigator.clipboard.writeText(val);
    handleFeedback(btn, 'Copied!');
  }

  function handleFeedback(btn, message) {
    const originalText = btn.innerHTML;
    btn.innerHTML = `<span class="success-text">${message}</span>`;
    btn.style.borderColor = 'var(--success)';
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.borderColor = '';
    }, 1500);
  }

  function filterResults() {
    const query = document.getElementById('searchBar').value.toLowerCase();
    document.querySelectorAll('.match-card').forEach(card => {
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(query) ? 'block' : 'none';
    });
  }
</script>

</body>
</html>
