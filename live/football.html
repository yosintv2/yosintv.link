<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Football Match Schedule</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .match-row { transition: background-color 0.2s ease; }
    .match-row:hover { background-color: #f1f5f9; }
    .sidebar { transition: all 0.3s ease; }
    .tournament-item { cursor: pointer; transition: background-color 0.2s ease; }
    .tournament-item:hover { background-color: #e5e7eb; }
    .tournament-item.active { background-color: #bfdbfe; font-weight: bold; }
    .container { display: flex; justify-content: center; max-width: 1200px; margin: 0 auto; align-items: flex-start; padding: 1rem; }
    .tab { cursor: pointer; padding: 0.5rem 1rem; border-radius: 0.375rem; }
    .tab:hover { background-color: #e5e7eb; }
    .tab.active { background-color: #3b82f6; color: white; font-weight: bold; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container">
    <div class="flex-1 max-w-2xl">
      <div id="scheduleHeader" class="text-3xl font-bold text-center text-gray-800 mb-2 hidden"></div>
      <div class="flex space-x-4 mb-4 justify-center">
        <div class="tab" data-day="yesterday">Yesterday</div>
        <div class="tab" data-day="today">Today</div>
        <div class="tab" data-day="tomorrow">Tomorrow</div>
        <div class="tab active" data-day="all">All</div>
      </div>
      <div class="mb-6">
        <input type="text" id="searchInput" placeholder="Search by team name..." class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div class="loading text-center text-blue-600 text-lg font-medium" id="loading">Loading match details...</div>
      <div class="error text-center text-red-600 text-lg font-medium hidden" id="error"></div>
      <div class="bg-white rounded-lg shadow-md overflow-hidden" id="matchesContainer"></div>
    </div>
    <div class="sidebar w-64 ml-4 bg-white rounded-lg shadow-md p-4">
      <h2 class="text-lg font-semibold text-gray-700 mb-4">Tournaments</h2>
      <input type="text" id="tournamentSearch" placeholder="Search tournaments..." class="w-full p-2 mb-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <ul id="tournamentList" class="space-y-2"></ul>
    </div>
  </div>
  <script>
    let allMatches = [];
    let selectedTournament = null;
    let selectedDay = 'all';
    const currentDateTime = new Date();

    // Priority tournaments to show at the top if they have matches
    const priorityTournaments = [
      'UEFA Champions League',
      'Premier League',
      'LaLiga',
      'Bundesliga',
      'Serie A',
      'Ligue 1',
      'MLS',
      'Saudi Pro League',
      'Liga Portugal Betclic'

    ];

    function setScheduleHeader() {
      // Header is hidden, no content set
    }

    async function fetchMatchData() {
      try {
        // Fetch from first JSON
        const response1 = await fetch('https://ytvlive.pages.dev/today.json');
        if (!response1.ok) {
          throw new Error('Failed to fetch first match data');
        }
        const data1 = await response1.json();
        let matches1 = data1.events || [];

        // Fetch from second JSON
        const response2 = await fetch('https://ytvlive.pages.dev/tomorrow.json');
        let matches2 = [];
        if (response2.ok) {
          const data2 = await response2.json();
          matches2 = data2.events || [];
        } else {
          console.warn('Failed to fetch second match data, proceeding with first only');
        }

        // Combine matches and remove duplicates based on match ID
        const matchIds = new Set();
        allMatches = [...matches1, ...matches2].filter(match => {
          if (matchIds.has(match.id)) {
            return false; // Skip duplicates
          }
          matchIds.add(match.id);
          return true;
        });

        setScheduleHeader();
        displayTournaments();
        filterMatches();
      } catch (error) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('error').textContent = 'Error: ' + error.message;
      }
    }

    function convertToLocalTime(timestamp) {
      const date = new Date(timestamp * 1000);
      return new Intl.DateTimeFormat('en-US', { month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).format(date).replace(',', '');
    }

    function groupMatchesByDate(matches) {
      const grouped = {};
      matches.forEach(match => {
        const localTime = convertToLocalTime(match.startTimestamp);
        const date = localTime.match(/(\w+ \d{2})/)[0];
        if (!grouped[date]) {
          grouped[date] = [];
        }
        grouped[date].push(match);
      });
      return grouped;
    }

    function displayMatches(matches) {
      document.getElementById('loading').classList.add('hidden');
      const matchesContainer = document.getElementById('matchesContainer');
      matchesContainer.innerHTML = '';
      const groupedMatches = groupMatchesByDate(matches);
      Object.keys(groupedMatches).sort().forEach(date => {
        const dateDiv = document.createElement('div');
        dateDiv.innerHTML = `<div class="bg-gray-200 p-4 font-semibold text-gray-700 text-lg">${date}</div>`;
        matchesContainer.appendChild(dateDiv);
        const matchesForDate = selectedTournament ? groupedMatches[date].sort((a, b) => {
          const timeA = convertToLocalTime(a.startTimestamp).match(/(\d{2}:\d{2})/)[0];
          const timeB = convertToLocalTime(b.startTimestamp).match(/(\d{2}:\d{2})/)[0];
          return timeA.localeCompare(timeB);
        }) : groupedMatches[date];
        matchesForDate.forEach(match => {
          const matchDiv = document.createElement('div');
          matchDiv.className = 'match-row grid grid-cols-2 gap-4 p-4 border-b border-gray-200 text-gray-600';
          const localTime = convertToLocalTime(match.startTimestamp);
          const timeParts = localTime.match(/(\d{2}:\d{2})/)[0];
          const matchName = `${match.homeTeam.name} vs ${match.awayTeam.name}`;
          matchDiv.innerHTML = `<div>${timeParts}</div><div>${matchName}</div>`;
          dateDiv.appendChild(matchDiv);
        });
      });
    }

    function displayTournaments() {
      const tournamentList = document.getElementById('tournamentList');
      const allTournamentsSet = [...new Set(allMatches.map(match => match.tournament.uniqueTournament.name))];
      const tournamentSearchTerm = document.getElementById('tournamentSearch').value.toLowerCase();
      const allTournaments = allTournamentsSet.filter(t => t.toLowerCase().includes(tournamentSearchTerm));

      // Filter priority tournaments to only those with matches
      const availablePriorityTournaments = priorityTournaments.filter(tournament => 
        allTournaments.includes(tournament)
      );
      const otherTournaments = allTournaments.filter(t => !priorityTournaments.includes(t)).sort();

      // Build tournament list HTML
      let html = '<li class="tournament-item p-2 rounded-lg ' + (selectedTournament === null ? 'active' : '') + '" data-tournament="all">All Tournaments</li>';
      availablePriorityTournaments.forEach(tournament => {
        html += `<li class="tournament-item p-2 rounded-lg ${selectedTournament === tournament ? 'active' : ''}" data-tournament="${tournament}">${tournament}</li>`;
      });
      otherTournaments.forEach(tournament => {
        html += `<li class="tournament-item p-2 rounded-lg ${selectedTournament === tournament ? 'active' : ''}" data-tournament="${tournament}">${tournament}</li>`;
      });
      tournamentList.innerHTML = html;

      // Add event listeners
      document.querySelectorAll('.tournament-item').forEach(item => {
        item.addEventListener('click', () => {
          selectedTournament = item.dataset.tournament === 'all' ? null : item.dataset.tournament;
          document.querySelectorAll('.tournament-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          filterMatches();
        });
      });
    }

    function filterMatches() {
      const teamSearchTerm = document.getElementById('searchInput').value.toLowerCase();
      let filteredMatches = allMatches;
      if (selectedDay !== 'all') {
        const today = new Date(currentDateTime);
        today.setHours(0, 0, 0, 0);
        let targetDate;
        if (selectedDay === 'yesterday') {
          targetDate = new Date(today);
          targetDate.setDate(today.getDate() - 1);
        } else if (selectedDay === 'today') {
          targetDate = new Date(today);
        } else if (selectedDay === 'tomorrow') {
          targetDate = new Date(today);
          targetDate.setDate(today.getDate() + 1);
        }
        filteredMatches = filteredMatches.filter(match => {
          const matchDate = new Date(match.startTimestamp * 1000);
          matchDate.setHours(0, 0, 0, 0);
          return matchDate.getTime() === targetDate.getTime();
        });
      }
      if (selectedTournament) {
        filteredMatches = filteredMatches.filter(match => match.tournament.uniqueTournament.name === selectedTournament);
      }
      filteredMatches = filteredMatches.filter(match => {
        const team1 = match.homeTeam.name.toLowerCase();
        const team2 = match.awayTeam.name.toLowerCase();
        return team1.includes(teamSearchTerm) || team2.includes(teamSearchTerm);
      });
      displayTournaments();
      displayMatches(filteredMatches);
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        selectedDay = tab.dataset.day;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        filterMatches();
      });
    });

    document.getElementById('searchInput').addEventListener('input', filterMatches);
    document.getElementById('tournamentSearch').addEventListener('input', filterMatches);

    window.onload = fetchMatchData;
  </script>
</body>
</html>
